<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Smit, A. J.">
<meta name="dcterms.date" content="2021-01-01">

<title>14. Mapping with Natural Earth – SAMOS R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../intro_r/12-mapping_quakes.html" rel="next">
<link href="../intro_r/10-mapping_style.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-21fe018c864e78632dc0e35f28f7bac9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">SAMOS R</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../intro_r/01-RStudio.html"> 
<span class="menu-text">Intro to R</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../basic_stats/02-summarise-and-describe.html"> 
<span class="menu-text">Biostatistics</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../tasks/BCB744_Task_A.html"> 
<span class="menu-text">Tasks</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../intro_r/01-RStudio.html">Introduction to R</a></li><li class="breadcrumb-item"><a href="../intro_r/11-mapping_rnaturalearth.html">14. Mapping with Natural Earth</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/SAMOS-logo-transparent.png" alt="" class="sidebar-logo light-content py-0 d-lg-inline d-none">
      <img src="../images/SAMOS-logo-transparent.png" alt="" class="sidebar-logo dark-content py-0 d-lg-inline d-none">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Introduction to R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_r/01-RStudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. R and RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_r/02-working-with-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Working with Data and Code</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_r/03-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. R Markdown and Quarto</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_r/04-data-in-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Data Classes and Structures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_r/05-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. R Workflows</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_r/13-tidy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Tidy Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_r/14-tidier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. Tidier Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_r/15-tidiest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. Tidiest Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_r/06-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. Graphics with <strong>ggplot2</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_r/07-faceting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. Faceting Figures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_r/08-brewing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11. Brewing Colours</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_r/09-mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12. Mapping with <strong>ggplot2</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_r/10-mapping_style.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13. Mapping with Style</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_r/11-mapping_rnaturalearth.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">14. Mapping with Natural Earth</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_r/12-mapping_quakes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">15. The Fiji Earthquake Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_r/16-recap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">16. Synthesis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_r/17-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">17. Functions by Chapter</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_r/18-base_r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">18. Base R Primer</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_r/19-dates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">19. Dates</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Biostatistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basic_stats/02-summarise-and-describe.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Data Summaries &amp; Descriptions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basic_stats/03-visualise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Statistical Figures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basic_stats/04-distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Data Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basic_stats/05-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Statistical Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basic_stats/06-assumptions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Assumptions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basic_stats/07-t_tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. <em>t</em>-Tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basic_stats/08-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. ANOVA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basic_stats/09-regressions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. Simple Linear Regressions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basic_stats/10-correlations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. Correlations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basic_stats/11-decision_guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11. Parametric Tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basic_stats/12-glance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12. Non-Parametric Tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basic_stats/13-confidence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13. Confidence Intervals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basic_stats/14-transformations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">14. Data Transformations</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Tasks</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tasks/BCB744_Task_A.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB744 Task A</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tasks/BCB744_Task_B.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB744 Task B</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tasks/BCB744_Task_C.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB744 Task C</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tasks/BCB744_Task_D.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB744 Task D</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tasks/BCB744_Task_E.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB744 Task E</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tasks/BCB744_Task_F.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB744 Task F</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tasks/BCB744_Task_G.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB744 Task G</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tasks/BCB744_Task_H.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB744 Task G</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tasks/BCB744_Task_Bonus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB744 Bonus Task</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#orientation-what-you-are-here-to-learn" id="toc-orientation-what-you-are-here-to-learn" class="nav-link active" data-scroll-target="#orientation-what-you-are-here-to-learn"><span class="header-section-number">1</span> Orientation: What You Are Here to Learn</a>
  <ul class="collapse">
  <li><a href="#learning-goals" id="toc-learning-goals" class="nav-link" data-scroll-target="#learning-goals"><span class="header-section-number">1.1</span> Learning Goals</a></li>
  <li><a href="#workflow-overview" id="toc-workflow-overview" class="nav-link" data-scroll-target="#workflow-overview"><span class="header-section-number">1.2</span> Workflow Overview</a></li>
  <li><a href="#web-resources-for-spatial-work-in-r" id="toc-web-resources-for-spatial-work-in-r" class="nav-link" data-scroll-target="#web-resources-for-spatial-work-in-r"><span class="header-section-number">1.3</span> Web Resources for Spatial Work in R</a></li>
  <li><a href="#what-to-aspire-to" id="toc-what-to-aspire-to" class="nav-link" data-scroll-target="#what-to-aspire-to"><span class="header-section-number">1.4</span> What to Aspire to</a></li>
  </ul></li>
  <li><a href="#the-sf-package" id="toc-the-sf-package" class="nav-link" data-scroll-target="#the-sf-package"><span class="header-section-number">2</span> The <strong>sf</strong> Package</a></li>
  <li><a href="#maps-with-rnaturalearth" id="toc-maps-with-rnaturalearth" class="nav-link" data-scroll-target="#maps-with-rnaturalearth"><span class="header-section-number">3</span> Maps With <strong>rnaturalearth</strong></a></li>
  <li><a href="#install-packages-and-set-things-up" id="toc-install-packages-and-set-things-up" class="nav-link" data-scroll-target="#install-packages-and-set-things-up"><span class="header-section-number">4</span> Install Packages and Set Things Up</a>
  <ul class="collapse">
  <li><a href="#define-a-working-extent" id="toc-define-a-working-extent" class="nav-link" data-scroll-target="#define-a-working-extent"><span class="header-section-number">4.1</span> Define a Working Extent</a></li>
  </ul></li>
  <li><a href="#create-and-inspect-an-sf-object" id="toc-create-and-inspect-an-sf-object" class="nav-link" data-scroll-target="#create-and-inspect-an-sf-object"><span class="header-section-number">5</span> Create and Inspect an <code>sf</code> Object</a>
  <ul class="collapse">
  <li><a href="#load-features-from-natural-earth" id="toc-load-features-from-natural-earth" class="nav-link" data-scroll-target="#load-features-from-natural-earth"><span class="header-section-number">5.1</span> Load Features from Natural Earth</a></li>
  <li><a href="#inspect-the-geometry-and-crs" id="toc-inspect-the-geometry-and-crs" class="nav-link" data-scroll-target="#inspect-the-geometry-and-crs"><span class="header-section-number">5.2</span> Inspect the Geometry and Crs</a></li>
  <li><a href="#plot-quickly-in-base-r" id="toc-plot-quickly-in-base-r" class="nav-link" data-scroll-target="#plot-quickly-in-base-r"><span class="header-section-number">5.3</span> Plot Quickly in Base R</a></li>
  <li><a href="#dissolve-and-crop-features-geometry-changes" id="toc-dissolve-and-crop-features-geometry-changes" class="nav-link" data-scroll-target="#dissolve-and-crop-features-geometry-changes"><span class="header-section-number">5.4</span> Dissolve and Crop Features (geometry changes)</a></li>
  <li><a href="#buffering-and-geometry-assumptions" id="toc-buffering-and-geometry-assumptions" class="nav-link" data-scroll-target="#buffering-and-geometry-assumptions"><span class="header-section-number">5.5</span> Buffering and Geometry Assumptions</a></li>
  </ul></li>
  <li><a href="#a-reusable-workflow" id="toc-a-reusable-workflow" class="nav-link" data-scroll-target="#a-reusable-workflow"><span class="header-section-number">6</span> A Reusable Workflow</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example"><span class="header-section-number">7</span> Example</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../intro_r/01-RStudio.html">Introduction to R</a></li><li class="breadcrumb-item"><a href="../intro_r/11-mapping_rnaturalearth.html">14. Mapping with Natural Earth</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">14. Mapping with Natural Earth</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Smit, A. J. <a href="https://orcid.org/0000-0002-3799-6126" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://uwc.ac.za">
            University of the Western Cape
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 1, 2021</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><img src="../images/SAMOS-logo-transparent.png" class="img-fluid" style="width:35.0%"></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/thesaurus.jpg" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption>A reminder that names and classifications matter.</figcaption>
</figure>
</div>
<blockquote class="blockquote">
<p>“<em>In the beginning there was nothing, which exploded.</em>”</p>
<p>— Terry Pratchett</p>
</blockquote>
<blockquote class="blockquote">
<p>“<em>Biology is the study of complicated things that have the appearance of having been designed with a purpose.</em>”</p>
<p>— Richard Dawkins</p>
</blockquote>
<section id="orientation-what-you-are-here-to-learn" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Orientation: What You Are Here to Learn</h1>
<p>Up to now, your maps have likely been <em>drawn</em> rather than <em>reasoned about</em>. This chapter shifts you from decorative mapping to spatial reasoning with data structures that carry geometry, scale, and assumptions. The goal is to make them more defensible.</p>
<section id="learning-goals" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="learning-goals"><span class="header-section-number">1.1</span> Learning Goals</h2>
<p>By the end of this chapter you should be able to:</p>
<ol type="1">
<li>Explain what an <code>sf</code> object is (features, attributes, geometry column, CRS).</li>
<li>Subset and transform spatial features without losing geometry.</li>
<li>Produce layered maps in base R and <strong>ggplot2</strong> with explicit spatial choices.</li>
</ol>
</section>
<section id="workflow-overview" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="workflow-overview"><span class="header-section-number">1.2</span> Workflow Overview</h2>
<p>When you are working independently, aim for this repeatable sequence:</p>
<ol type="1">
<li>Load data and inspect the geometry and CRS.</li>
<li>Subset features (rows) and attributes (columns) intentionally.</li>
<li>Crop or transform geometry only when you mean to.</li>
<li>Plot in base R or <strong>ggplot2</strong>, then refine.</li>
</ol>
</section>
<section id="web-resources-for-spatial-work-in-r" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="web-resources-for-spatial-work-in-r"><span class="header-section-number">1.3</span> Web Resources for Spatial Work in R</h2>
<p>These are reference texts, not required reading. Use them as technical back-up when you get stuck or want to go deeper.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Web Resources About Spatial Methods in R
</div>
</div>
<div class="callout-body-container callout-body">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Author</th>
<th style="text-align: left;">Title</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Spatial R</strong></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Edzer Pebesma</td>
<td style="text-align: left;"><a href="https://r-spatial.github.io/sf/index.html">Simple Features for R</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Edzer Pebesma, Roger Bivand</td>
<td style="text-align: left;"><a href="https://r-spatial.org/book/">Spatial Data Science with applications in R</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">Robin Lovelace et al.</td>
<td style="text-align: left;"><a href="https://geocompr.robinlovelace.net/index.html">Geocomputation with R</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Manuel Gimond</td>
<td style="text-align: left;"><a href="https://mgimond.github.io/Spatial/index.html">Intro to GIS and Spatial Analysis</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">Wasser et al.</td>
<td style="text-align: left;"><a href="https://datacarpentry.org/r-raster-vector-geospatial/">Introduction to Geospatial Raster and Vector Data with R</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Taro Mieno</td>
<td style="text-align: left;"><a href="https://tmieno2.github.io/R-as-GIS-for-Economists/">R as GIS for Economists</a></td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="what-to-aspire-to" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="what-to-aspire-to"><span class="header-section-number">1.4</span> What to Aspire to</h2>
<p>Please see the snooty maps at <a href="https://bedeffinianrowedavies.com/intermediatertutorials/makingmaps">Making Static Maps in R</a>. The skills you acquire in this module should eventually allow you to do similar maps.</p>
</section>
</section>
<section id="the-sf-package" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> The <strong>sf</strong> Package</h1>
<p>At this point you need data structures that carry geometry and behave sensibly under spatial operations. The <a href="https://r-spatial.github.io/sf/"><strong>sf</strong></a> package provides exactly that, and it has become the <em>de facto</em> tool for many mapping applications, replacing older packages such as <strong>sp</strong>. It provides classes for storing and manipulating simple feature geometries and functions for working with spatial data. <em>Simple features</em> refer to a standardised way of encoding vector data — points, lines, and polygons — used widely in GIS.</p>
<p>The <strong>sf</strong> package was created to provide a fast and efficient way to work with vector data in R. It integrates with other <strong>tidyverse</strong> packages, such as <strong>dplyr</strong> and <strong>ggplot2</strong>, allowing for seamless processing and visualisation of spatial data. The package provides a variety of functions for data import, transformation, manipulation, and analysis, making it a valuable tool for working with spatial data in R.</p>
<p>In addition to its core functionality, the <strong>sf</strong> package also provides a set of methods for converting between different data representations, such as data frames, matrices, and lists, making it a versatile tool for working with spatial data in a variety of formats.</p>
<p>While <strong>sf</strong> works with vector data, raster data require the well-known but older <a href="https://rspatial.org/raster/pkg/index.html"><strong>raster</strong></a> package, or its modern replacements <a href="https://rspatial.org/pkg/index.html"><strong>terra</strong></a>, <a href="https://r-spatial.github.io/stars/"><strong>stars</strong></a>. I will not work with raster data in this chapter.</p>
</section>
<section id="maps-with-rnaturalearth" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Maps With <strong>rnaturalearth</strong></h1>
<p><a href="https://www.naturalearthdata.com/">Natural Earth</a> is a public domain map dataset that provides high-quality, general-purpose base maps for the world at various scales. It is an ideal stepping stone when <code>map_data()</code> and hand-drawn polygons become too crude or too brittle for serious work. It was designed to be a visually pleasing alternative to other public domain datasets, and its creators aim to provide the data in a form that is useful for a wide range of applications, to make it easy to use and integrate with other data.</p>
<p>The dataset includes a variety of geographic features, including coastlines, rivers, lakes, and political boundaries, as well as cultural features like cities, roads, and railways. The data are available in several formats, including vector and raster, and they can be used with a variety of software, including GIS and mapping applications. Within R we can access these map layers using the <a href="https://cran.r-project.org/web/packages/rnaturalearth/vignettes/rnaturalearth.html"><strong>rnaturalearth</strong></a> package.</p>
<p>One of the key benefits of Natural Earth is its public domain status, which means that anyone can use, distribute the data without restrictions or licensing fees. This makes it an ideal choice for individuals who need high-quality base maps for their projects but may not have the resources or expertise to create them from scratch. I am not convinced that students actually read this. The first person to send me a WhatsApp mentioning the phrase “Know your maps” will get a Lindt chocolate.</p>
<p>In addition to its public domain status, Natural Earth is regularly updated with new data to ensure that the maps remain accurate and up to date. This makes it a valuable resource for anyone who needs reliable geographic data.</p>
</section>
<section id="install-packages-and-set-things-up" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Install Packages and Set Things Up</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># install.packages("rnaturalearth", "rnaturalearthdata", "sf")</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(rnaturalearthdata)</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co"># for the buffer to work as I expect, switch off</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co"># the functions for spherical geometry:</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="fu">sf_use_s2</span>(<span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Geometry Assumptions and <code>sf_use_s2()</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>s2</code> engine treats the Earth as a sphere. Some operations — notably buffering — behave differently under spherical versus planar assumptions. Turning <code>s2</code> off can be useful for small regional maps, but it does <strong>not</strong> make distances in degrees suddenly meaningful. If you need accurate distances, use a projected CRS and keep <code>s2</code> on.</p>
</div>
</div>
<section id="define-a-working-extent" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="define-a-working-extent"><span class="header-section-number">4.1</span> Define a Working Extent</h2>
<p>First, I define the extent of the map region:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># the full map extent:</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>xmin <span class="ot">&lt;-</span> <span class="dv">12</span>; ymin <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">36.5</span>; xmax <span class="ot">&lt;-</span> <span class="fl">40.5</span>; ymax <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">10</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>xlim <span class="ot">&lt;-</span> <span class="fu">c</span>(xmin, xmax); ylim <span class="ot">&lt;-</span> <span class="fu">c</span>(ymin, ymax)</span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co"># make a bounding box for cropping:</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>bbox <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin =</span> xmin, <span class="at">ymin =</span> ymin,</span>
<span id="cb2-7"><a href="#cb2-7"></a>  <span class="at">xmax =</span> xmax, <span class="at">ymax =</span> ymax))</span>
<span id="cb2-8"><a href="#cb2-8"></a></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co"># might be useful for zooming into a smaller region (False Bay and </span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co"># the Cape Peninsula):</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>xlim_zoom <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">17.8</span>, <span class="dv">19</span>); ylim_zoom <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">34.5</span>, <span class="sc">-</span><span class="fl">33.2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Choosing bounds is a cartographic decision. If you clip too tightly you can hide relevant context; if you clip too loosely you dilute the focus of the map. Cropping can also cut features that cross the boundary (and cuase complications, which are very difficult to rectify), so use it deliberately.</p>
</section>
</section>
<section id="create-and-inspect-an-sf-object" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Create and Inspect an <code>sf</code> Object</h1>
<p>Before we draw anything, we will load a spatial object, then <em>inspect</em> it. This is the point where your thinking should shift from “plots” to “features with geometry”.</p>
<section id="load-features-from-natural-earth" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="load-features-from-natural-earth"><span class="header-section-number">5.1</span> Load Features from Natural Earth</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># load the countries:</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>safrica_countries <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">returnclass =</span> <span class="st">'sf'</span>,</span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="at">continent =</span> <span class="st">"Africa"</span>,</span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="at">country =</span> <span class="fu">c</span>(<span class="st">"South Africa"</span>, <span class="st">"Mozambique"</span>,</span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="st">"Namibia"</span>, <span class="st">"Zimbabwe"</span>, <span class="st">"Botswana"</span>,</span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="st">"Lesotho"</span>, <span class="st">"Eswatini"</span>),</span>
<span id="cb3-7"><a href="#cb3-7"></a>  <span class="at">scale =</span> <span class="st">"large"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The object now contains <em>features</em> (rows) with <em>attributes</em> (columns) plus a geometry column that stores the spatial shapes. That geometry persists unless you explicitly alter it.</p>
</section>
<section id="inspect-the-geometry-and-crs" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="inspect-the-geometry-and-crs"><span class="header-section-number">5.2</span> Inspect the Geometry and Crs</h2>
<p>Pause here and check what makes this different from a normal tibble.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">class</span>(safrica_countries)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] "sf"         "data.frame"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># safrica_countries</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>The <code>sf</code> Class
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>sf</code> indicates that the object is of class <em>simple features</em>. In <strong>sf</strong> language, what would be called columns (variables) in normal <strong>tidyverse</strong> speak becomes known as <em>attributes</em> — these are the properties of the map <em>features</em>. The geometry column stores the shapes; the CRS stores the spatial reference system.</p>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Run this on your PC... the output is too voluminous for here</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="fu">glimpse</span>(safrica_countries)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="fu">st_crs</span>(safrica_countries)</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="fu">unique</span>(<span class="fu">st_geometry_type</span>(safrica_countries))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The CRS tells you how the coordinates should be interpreted. You do not need to manipulate CRS yet, but you do need to be aware that distance and area calculations depend on it.</p>
<p>As you can see, it is a <code>data.frame</code> and <code>tbl</code> (tibble), amongst other classes, and so you can apply many of the <strong>tidyverse</strong> functions to it, including <code>select()</code>, <code>filter()</code>, <code>summarise()</code> and so on. These verbs act on <em>attributes</em> unless you explicitly change geometry with <strong>sf</strong> functions.</p>
</section>
<section id="plot-quickly-in-base-r" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="plot-quickly-in-base-r"><span class="header-section-number">5.3</span> Plot Quickly in Base R</h2>
<p>Let us plot the entire <code>safrica_countries</code> object to see all the attributes of all of the features. This kind of figure is called a choropleth map:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">plot</span>(safrica_countries)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-plot-safrica-countries" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plot-safrica-countries-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-mapping_rnaturalearth_files/figure-html/fig-plot-safrica-countries-1.png" class="img-fluid figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plot-safrica-countries-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Southern Africa countries shown as a base R choropleth.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Attributes vs Features (select vs filter)
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <code>select()</code> to choose <em>attributes</em> (columns). Use <code>filter()</code> to choose <em>features</em> (rows). Neither operation recalculates geometry; the shapes persist unless you explicitly transform them.</p>
</div>
</div>
<p>You probably do not want to plot all of them. Let us select one:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">plot</span>(safrica_countries[<span class="st">"sovereignt"</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-plot-safrica-countries-sovereignt" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plot-safrica-countries-sovereignt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-mapping_rnaturalearth_files/figure-html/fig-plot-safrica-countries-sovereignt-1.png" class="img-fluid figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plot-safrica-countries-sovereignt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Southern Africa countries shaded by sovereignty.
</figcaption>
</figure>
</div>
</div>
</div>
<p>You might achieve the same in a more familiar way:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>safrica_countries <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="fu">select</span>(sovereignt) <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="fu">plot</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-safrica-countries" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-safrica-countries-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-mapping_rnaturalearth_files/figure-html/fig-safrica-countries-1.png" class="img-fluid figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-safrica-countries-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Southern Africa countries shaded by sovereignty (select).
</figcaption>
</figure>
</div>
</div>
</div>
<p>Or you may want to plot the estimate of the population size, which is contained in the attribute <code>pop_est</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>safrica_countries <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="fu">select</span>(pop_est) <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="fu">plot</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-safrica-countries-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-safrica-countries-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-mapping_rnaturalearth_files/figure-html/fig-safrica-countries-2-1.png" class="img-fluid figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-safrica-countries-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Southern Africa countries shaded by population estimate.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The names of the countries are in the rows of the <code>safrica_countries</code> object, and so they become accessible with <code>filter()</code>. Let us only plot some attribute for South Africa:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>safrica_countries <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href="#cb12-2"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(sovereignt <span class="sc">==</span> <span class="st">"South Africa"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="fu">select</span>(sovereignt) <span class="sc">|&gt;</span> </span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="fu">plot</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-safrica-countries-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-safrica-countries-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-mapping_rnaturalearth_files/figure-html/fig-safrica-countries-3-1.png" class="img-fluid figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-safrica-countries-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: South Africa feature only (sovereignty filtered).
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="dissolve-and-crop-features-geometry-changes" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="dissolve-and-crop-features-geometry-changes"><span class="header-section-number">5.4</span> Dissolve and Crop Features (geometry changes)</h2>
<p>The following sequence is dense, so here is the logic before the code:</p>
<ol type="1">
<li><code>group_by(continent)</code> groups features so that later operations can dissolve borders.</li>
<li><code>summarise()</code> collapses grouped features into a single geometry per group.</li>
<li><code>st_crop(bbox)</code> clips the geometry to your bounding box. This can <em>cut</em> features at the boundary.</li>
<li><code>st_combine()</code> merges the pieces into a single multipart feature.</li>
</ol>
<p>Cropping is a geometric operation, but sometimes it may be used as a visual zoom. Features that fall partly inside the box will be clipped.</p>
<p>You can continue to add additional operations to create a new map:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>safrica_countries_new <span class="ot">&lt;-</span> safrica_countries <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="fu">group_by</span>(continent) <span class="sc">|&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">summarise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="fu">st_crop</span>(bbox) <span class="sc">|&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="fu">st_combine</span>()</span>
<span id="cb13-6"><a href="#cb13-6"></a></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="fu">plot</span>(safrica_countries_new)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-safrica-countries-new-safrica-countries" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-safrica-countries-new-safrica-countries-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-mapping_rnaturalearth_files/figure-html/fig-safrica-countries-new-safrica-countries-1.png" class="img-fluid figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-safrica-countries-new-safrica-countries-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Dissolved and cropped Southern Africa geometry.
</figcaption>
</figure>
</div>
</div>
</div>
<p>So far you have relied on the base R plot function made for simple features. You can also plot the map in <strong>ggplot2</strong> using <code>ggplot()</code>, which treats geometry as data rather than annotation. Here, <code>geom_sf()</code> draws the features and <code>coord_sf()</code> manages the spatial coordinates and aspect ratio. This is why <code>coord_sf()</code> is preferred to <code>coord_cartesian()</code> for maps.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> safrica_countries,</span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="at">colour =</span> <span class="st">"indianred"</span>, <span class="at">fill =</span> <span class="st">"beige"</span>) <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> xlim,</span>
<span id="cb14-5"><a href="#cb14-5"></a>           <span class="at">ylim =</span> ylim)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-ggplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ggplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-mapping_rnaturalearth_files/figure-html/fig-ggplot-1.png" class="img-fluid figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ggplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Southern Africa map drawn with ggplot2 and geom_sf.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="buffering-and-geometry-assumptions" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="buffering-and-geometry-assumptions"><span class="header-section-number">5.5</span> Buffering and Geometry Assumptions</h2>
<p>Now you can layer another feature. This is also where geometry assumptions matter: buffering in degrees is only a rough approximation for local maps.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>buffer <span class="ot">&lt;-</span> safrica_countries_new <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="fu">st_buffer</span>(<span class="fl">0.4</span>)</span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> buffer, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">col =</span> <span class="st">"transparent"</span>) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> safrica_countries, <span class="at">colour =</span> <span class="st">"indianred"</span>, <span class="at">fill =</span> <span class="st">"beige"</span>) <span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-buffer-safrica-countries-new" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-buffer-safrica-countries-new-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-mapping_rnaturalearth_files/figure-html/fig-buffer-safrica-countries-new-1.png" class="img-fluid figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-buffer-safrica-countries-new-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Buffered Southern Africa geometry overlaid on the original map.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Distances Are Not Degrees
</div>
</div>
<div class="callout-body-container callout-body">
<p>If a buffer value “looks right” in degrees, that is an accident of scale. For accurate distances, project your data first and buffer in metres.</p>
</div>
</div>
</section>
</section>
<section id="a-reusable-workflow" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> A Reusable Workflow</h1>
<p>When you start from scratch, use this quick recipe:</p>
<ol type="1">
<li>Load spatial data and check <code>st_crs()</code> and geometry types.</li>
<li>Filter features (rows) and select attributes (columns) deliberately.</li>
<li>Crop or transform geometry only when you intend to change shape.</li>
<li>Plot with <code>plot()</code> or <strong>ggplot2</strong>; add layers and styling last.</li>
</ol>
<div class="callout callout-style-simple callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Caution</span>Common Pitfalls to Watch for
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Buffering or measuring in degrees instead of projected units.</li>
<li>Cropping after styling, which hides clipped features or labels.</li>
<li>Assuming <code>select()</code> or <code>summarise()</code> recalculates geometry.</li>
<li>Using <code>coord_cartesian()</code> for maps and silently distorting aspect ratio.</li>
<li>Treating Natural Earth borders as definitive boundaries when precision matters.</li>
</ul>
</div>
</div>
</section>
<section id="example" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Example</h1>
<p>Here are examples that use the built-in <a href="../intro_r/12-mapping_quakes.html">Fiji earthquake data</a> or the <a href="../../pages/kaggle_earthquakes.qmd">Kaggle earthquake data</a>.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{a._j.2021,
  author = {A. J. , Smit},
  title = {14. {Mapping} with {Natural} {Earth}},
  date = {2021-01-01},
  url = {http://samos-r.netlify.app/intro_r/11-mapping_rnaturalearth.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-a._j.2021" class="csl-entry quarto-appendix-citeas" role="listitem">
A. J. S (2021) 14. Mapping with Natural Earth. <a href="http://samos-r.netlify.app/intro_r/11-mapping_rnaturalearth.html">http://samos-r.netlify.app/intro_r/11-mapping_rnaturalearth.html.
</a>
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("http:\/\/samos-r\.netlify\.app");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../intro_r/10-mapping_style.html" class="pagination-link" aria-label="13. Mapping with Style">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">13. Mapping with Style</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../intro_r/12-mapping_quakes.html" class="pagination-link" aria-label="15. The Fiji Earthquake Data">
        <span class="nav-page-text">15. The Fiji Earthquake Data</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>